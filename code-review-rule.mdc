---
name: code-review
description: This is a new rule
---
alwaysApply: true

### 基本语法
```bash
/review         #审查当前工作区的变更
/review --b [branch] 
```

# Overview

Insert overview text here. The agent will only see this should they choose to apply the rule.
# Code Review 规范
你是 java 编程的专家，现在对代码进行Code Review，code-review范围是当前变更的内容（对比当前分支和main分支，整理出变更的代码文件，注意不包含单测文件） 请按照以下步骤进行: （若遇到 git 命令分页的情况，请加上`| cat`）

## 步骤1：代码规范检查
- [ ] 与main分支对比，整理出本次变更的业务代码文件（去除单测文件）
- [ ] 是否遵循最佳实践 @.cursor/rules/java-code-rule.mdc
- [ ] 是否存在重复代码，代码结构合理性
    - 一个类 / 一个方法只做一件事（单一职责原则），方法代码行数不宜过长
    - 避免嵌套过深（如 if-else、for 嵌套超过 3 层），可通过提前返回、抽取子方法优化
    - 提取公共逻辑为工具类（Util/Helper），工具类应设计为不可实例化（私有构造方法），方法为静态方法。
    - 避免硬编码（如常量、配置项、业务规则），优先抽取到配置文件（application.yml）、枚举类或常量类中。
- [ ] 是否有充分的注释和文档
- [ ] 是否易于理解和维护
    - 按需使用成熟的设计模式（如单例模式、工厂模式、策略模式），避免「过度设计」（简单场景无需强行套用设计模式）。
    - 单例模式需考虑线程安全（推荐使用枚举单例、懒汉式双重检查锁定），避免多线程环境下创建多个实例。
    - 避免滥用单例模式
- [ ] 检查日志打印的合理性，需遵循 “完整、精准、不重复
    - 避免使用 System.out.println()
    - 禁止打印敏感信息：密码、Token、身份证号、银行卡号等，如需记录需脱敏
    - 禁止拼接字符串：使用日志框架的参数化输出（{} 占位符），避免无意义的字符串拼接开销
    - 控制日志输出频率
        - 高频循环中避免打印 INFO 及以下级别日志（如每秒 1000 次的任务，仅记录每分钟统计结果）。
        - 对同一类型的 WARN 日志（如接口超时），可设置阈值（如 1 分钟内最多打印 5 次），避免刷屏。
        - 注意日志打印长度，导致日志内容过大

## 步骤2：功能问题分析，包含更深入的分析和具体的代码示例
- [ ] 分析本次代码改动的影响范围，以简洁的语言描述内容
- [ ] 分析是否是有参数校验，数值、格式、长度的参数，边界值问题，类型转换问题，进行说明并给出优化建议，包含更深入的分析和具体的代码示例
- [ ] 分析是否存在破坏性的代码改动，如有则需要全部列举出来，包含更深入的分析和具体的代码示例
- [ ] 分析是否存在明显的性能问题，进行说明并给出优化建议，包含更深入的分析和具体的代码示例
- [ ] 分析是否存在异常处理问题，进行说明并给出优化建议，包含更深入的分析和具体的代码示例
- [ ] 分析是否存在死锁的情况，进行说明并给出优化建议，包含更深入的分析和具体的代码示例
- [ ] 分析本次代码改动的是否存在bug，进行说明并给出优化建议，包含更深入的分析和具体的代码示例
    - 例如对象不同方法中被错误覆盖
    - 逻辑性前后依赖错误
- [ ] 沿用调用过程，追踪下游逻辑检查是否存在绕过检验，或者上下游逻辑不一致的情况；


## 步骤3：安全问题分析
- [ ] 分析是否包含敏感信息，如密码、密钥、证书等
- [ ] 分析是否SQL注入风险
- [ ] 检查项目中是否存在弱随机数安全问题，
    -【Java 标准库】
        - new Random() 或 java.util.Random
        - Math.random()
        - ThreadLocalRandom
    -【Apache Commons】
        - RandomStringUtils
        - RandomUtils
    -【Google Guava】
        - RandomSource.createThreadLocalRandom()
    -【自定义工具类】
        - CryptoUtil.getRandomCode() 或其他自定义随机数工具（需要检查实现）
    -【安全相关场景】
        重点关注：token生成、密钥生成、API Key、密码、验证码、加密操作、Session ID（安全相关）等



## 步骤4：分析服务影响（cmd 目录下是具体的服务）
- [ ] 根据代码改动，分析哪些服务需要进行发版？
<!-- - [ ] 若需要发版，服务之间是否有依赖关系？ -->
<!-- - [ ] 若需要发版，请总结出一份简要的发布说明 -->

## 步骤5：生成 Code Review 报告
将内容保存到 docs/code-review 目录下，文件名称为 `cr-$(date +%Y%m%d-%H%M%S).md`，例如 `cr-20240401-171335.md`，
生成的文档中，通过的检查项用绿色勾，不通过的检查项用红色叉。

## 步骤6：打开 Code Review 报告
使用命令 `cursor` 打开生成的报告文件。
